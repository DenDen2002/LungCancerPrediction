2025-05-14 03:02:17.016134: I tensorflow/core/util/port.cc:110] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2025-05-14 03:02:17.067755: I tensorflow/tsl/cuda/cudart_stub.cc:28] Could not find cuda drivers on your machine, GPU will not be used.
2025-05-14 03:02:17.482226: I tensorflow/tsl/cuda/cudart_stub.cc:28] Could not find cuda drivers on your machine, GPU will not be used.
2025-05-14 03:02:17.484213: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2025-05-14 03:02:18.810706: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
Matplotlib created a temporary cache directory at /tmp/matplotlib-bzj936ui because the default path (/.config/matplotlib) is not a writable directory; it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
25/05/14 03:02:22 INFO SparkContext: Running Spark version 3.3.0
25/05/14 03:02:22 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
25/05/14 03:02:22 INFO ResourceUtils: ==============================================================
25/05/14 03:02:22 INFO ResourceUtils: No custom resources configured for spark.driver.
25/05/14 03:02:22 INFO ResourceUtils: ==============================================================
25/05/14 03:02:22 INFO SparkContext: Submitted application: LungCancerClassification
25/05/14 03:02:22 INFO ResourceProfile: Default ResourceProfile created, executor resources: Map(cores -> name: cores, amount: 1, script: , vendor: , memory -> name: memory, amount: 8192, script: , vendor: , offHeap -> name: offHeap, amount: 0, script: , vendor: ), task resources: Map(cpus -> name: cpus, amount: 1.0)
25/05/14 03:02:22 INFO ResourceProfile: Limiting resource is cpu
25/05/14 03:02:22 INFO ResourceProfileManager: Added ResourceProfile id: 0
25/05/14 03:02:22 INFO SecurityManager: Changing view acls to: spark
25/05/14 03:02:22 INFO SecurityManager: Changing modify acls to: spark
25/05/14 03:02:22 INFO SecurityManager: Changing view acls groups to: 
25/05/14 03:02:22 INFO SecurityManager: Changing modify acls groups to: 
25/05/14 03:02:22 INFO SecurityManager: SecurityManager: authentication disabled; ui acls disabled; users  with view permissions: Set(spark); groups with view permissions: Set(); users  with modify permissions: Set(spark); groups with modify permissions: Set()
25/05/14 03:02:22 INFO Utils: Successfully started service 'sparkDriver' on port 33147.
25/05/14 03:02:22 INFO SparkEnv: Registering MapOutputTracker
25/05/14 03:02:22 INFO SparkEnv: Registering BlockManagerMaster
25/05/14 03:02:22 INFO BlockManagerMasterEndpoint: Using org.apache.spark.storage.DefaultTopologyMapper for getting topology information
25/05/14 03:02:22 INFO BlockManagerMasterEndpoint: BlockManagerMasterEndpoint up
25/05/14 03:02:22 INFO SparkEnv: Registering BlockManagerMasterHeartbeat
25/05/14 03:02:22 INFO DiskBlockManager: Created local directory at /tmp/blockmgr-ac82edb9-c5e8-411d-bf9e-2ce4b4d3efa0
25/05/14 03:02:22 INFO MemoryStore: MemoryStore started with capacity 366.3 MiB
25/05/14 03:02:22 INFO SparkEnv: Registering OutputCommitCoordinator
25/05/14 03:02:23 WARN Utils: Service 'SparkUI' could not bind on port 4040. Attempting port 4041.
25/05/14 03:02:23 INFO Utils: Successfully started service 'SparkUI' on port 4041.
25/05/14 03:02:23 INFO Executor: Starting executor ID driver on host 5707777395d1
25/05/14 03:02:23 INFO Executor: Starting executor with user classpath (userClassPathFirst = false): ''
25/05/14 03:02:23 INFO Utils: Successfully started service 'org.apache.spark.network.netty.NettyBlockTransferService' on port 37729.
25/05/14 03:02:23 INFO NettyBlockTransferService: Server created on 5707777395d1:37729
25/05/14 03:02:23 INFO BlockManager: Using org.apache.spark.storage.RandomBlockReplicationPolicy for block replication policy
25/05/14 03:02:23 INFO BlockManagerMaster: Registering BlockManager BlockManagerId(driver, 5707777395d1, 37729, None)
25/05/14 03:02:23 INFO BlockManagerMasterEndpoint: Registering block manager 5707777395d1:37729 with 366.3 MiB RAM, BlockManagerId(driver, 5707777395d1, 37729, None)
25/05/14 03:02:23 INFO BlockManagerMaster: Registered BlockManager BlockManagerId(driver, 5707777395d1, 37729, None)
25/05/14 03:02:23 INFO BlockManager: Initialized BlockManager: BlockManagerId(driver, 5707777395d1, 37729, None)
Loading datasets...
Showing train_df after useing get_labeled_paths this function:
root
 |-- content: binary (nullable = true)
 |-- path: string (nullable = true)
 |-- label: string (nullable = true)

processing Label...
Showing train_df after using label_index: {0: 'adenocarcinoma', 1: 'large_cell_carcinoma', 2: 'normal', 3: 'squamous_cell_carcinoma'}
Showing train_df:
root
 |-- content: binary (nullable = true)
 |-- path: string (nullable = true)
 |-- label: string (nullable = true)
 |-- label_index: integer (nullable = true)

Creating training dataset...

Total images loaded into train_data: 500
Total images loaded into train_ds: 16
Total images loaded into train_images: 500
Total images loaded into train_labels: 500
Total images loaded into train_df: 613
Total images loaded into valid_df: 72
Total images loaded into test_df: 315

--- Inspecting train_ds ---
Batch image shape : (32, 256, 256, 3)
Batch label shape : (32,)
Batch image dtype : <dtype: 'float32'>
Batch label dtype : <dtype: 'int64'>
First 5 labels    : [2 2 2 2 2]
Training model...
Epoch 1/10
 1/16 [>.............................] - ETA: 34s - loss: 1.1652 - accuracy: 0.6250 2/16 [==>...........................] - ETA: 5s - loss: 21.7888 - accuracy: 0.6875 3/16 [====>.........................] - ETA: 5s - loss: 33.7190 - accuracy: 0.6354 4/16 [======>.......................] - ETA: 4s - loss: 37.7477 - accuracy: 0.5469 5/16 [========>.....................] - ETA: 4s - loss: 38.0887 - accuracy: 0.5312 6/16 [==========>...................] - ETA: 3s - loss: 34.3374 - accuracy: 0.4896 7/16 [============>.................] - ETA: 3s - loss: 31.3826 - accuracy: 0.4688 8/16 [==============>...............] - ETA: 3s - loss: 29.1188 - accuracy: 0.4297 9/16 [===============>..............] - ETA: 2s - loss: 26.5965 - accuracy: 0.409710/16 [=================>............] - ETA: 2s - loss: 24.1628 - accuracy: 0.409411/16 [===================>..........] - ETA: 1s - loss: 22.0998 - accuracy: 0.406212/16 [=====================>........] - ETA: 1s - loss: 20.3740 - accuracy: 0.393213/16 [=======================>......] - ETA: 1s - loss: 18.9213 - accuracy: 0.387014/16 [=========================>....] - ETA: 0s - loss: 17.6687 - accuracy: 0.370515/16 [===========================>..] - ETA: 0s - loss: 16.5886 - accuracy: 0.354216/16 [==============================] - ETA: 0s - loss: 15.9819 - accuracy: 0.348016/16 [==============================] - 8s 346ms/step - loss: 15.9819 - accuracy: 0.3480
Epoch 2/10
 1/16 [>.............................] - ETA: 4s - loss: 0.9872 - accuracy: 0.8438 2/16 [==>...........................] - ETA: 4s - loss: 0.9173 - accuracy: 0.8281 3/16 [====>.........................] - ETA: 4s - loss: 0.9391 - accuracy: 0.7188 4/16 [======>.......................] - ETA: 3s - loss: 1.0397 - accuracy: 0.6172 5/16 [========>.....................] - ETA: 3s - loss: 1.1005 - accuracy: 0.5500 6/16 [==========>...................] - ETA: 3s - loss: 1.1189 - accuracy: 0.5260 7/16 [============>.................] - ETA: 2s - loss: 1.1414 - accuracy: 0.5268 8/16 [==============>...............] - ETA: 2s - loss: 1.1339 - accuracy: 0.5469 9/16 [===============>..............] - ETA: 2s - loss: 1.1149 - accuracy: 0.566010/16 [=================>............] - ETA: 1s - loss: 1.1312 - accuracy: 0.540611/16 [===================>..........] - ETA: 1s - loss: 1.1363 - accuracy: 0.536912/16 [=====================>........] - ETA: 1s - loss: 1.1484 - accuracy: 0.533913/16 [=======================>......] - ETA: 0s - loss: 1.1585 - accuracy: 0.521614/16 [=========================>....] - ETA: 0s - loss: 1.1600 - accuracy: 0.513415/16 [===========================>..] - ETA: 0s - loss: 1.1620 - accuracy: 0.508316/16 [==============================] - ETA: 0s - loss: 1.1634 - accuracy: 0.504016/16 [==============================] - 5s 314ms/step - loss: 1.1634 - accuracy: 0.5040
Epoch 3/10
 1/16 [>.............................] - ETA: 4s - loss: 0.6081 - accuracy: 0.7812 2/16 [==>...........................] - ETA: 4s - loss: 0.5415 - accuracy: 0.8438 3/16 [====>.........................] - ETA: 4s - loss: 0.5602 - accuracy: 0.8333 4/16 [======>.......................] - ETA: 3s - loss: 0.5705 - accuracy: 0.8125 5/16 [========>.....................] - ETA: 3s - loss: 0.6062 - accuracy: 0.7937 6/16 [==========>...................] - ETA: 3s - loss: 0.6322 - accuracy: 0.7865 7/16 [============>.................] - ETA: 2s - loss: 0.6517 - accuracy: 0.7857 8/16 [==============>...............] - ETA: 2s - loss: 0.6759 - accuracy: 0.7734 9/16 [===============>..............] - ETA: 2s - loss: 0.6712 - accuracy: 0.774310/16 [=================>............] - ETA: 1s - loss: 0.6666 - accuracy: 0.771911/16 [===================>..........] - ETA: 1s - loss: 0.6714 - accuracy: 0.758512/16 [=====================>........] - ETA: 1s - loss: 0.6753 - accuracy: 0.757813/16 [=======================>......] - ETA: 0s - loss: 0.7205 - accuracy: 0.742814/16 [=========================>....] - ETA: 0s - loss: 0.7227 - accuracy: 0.743315/16 [===========================>..] - ETA: 0s - loss: 0.7435 - accuracy: 0.729216/16 [==============================] - ETA: 0s - loss: 0.7418 - accuracy: 0.728016/16 [==============================] - 5s 315ms/step - loss: 0.7418 - accuracy: 0.7280
Epoch 4/10
 1/16 [>.............................] - ETA: 4s - loss: 0.2191 - accuracy: 0.9062 2/16 [==>...........................] - ETA: 4s - loss: 0.2761 - accuracy: 0.8750 3/16 [====>.........................] - ETA: 4s - loss: 0.2766 - accuracy: 0.8854 4/16 [======>.......................] - ETA: 3s - loss: 0.2753 - accuracy: 0.9062 5/16 [========>.....................] - ETA: 3s - loss: 0.2765 - accuracy: 0.9250 6/16 [==========>...................] - ETA: 3s - loss: 0.3033 - accuracy: 0.9115 7/16 [============>.................] - ETA: 2s - loss: 0.3128 - accuracy: 0.9018 8/16 [==============>...............] - ETA: 2s - loss: 0.3042 - accuracy: 0.9102 9/16 [===============>..............] - ETA: 2s - loss: 0.2990 - accuracy: 0.920110/16 [=================>............] - ETA: 1s - loss: 0.2966 - accuracy: 0.918711/16 [===================>..........] - ETA: 1s - loss: 0.2954 - accuracy: 0.923312/16 [=====================>........] - ETA: 1s - loss: 0.2900 - accuracy: 0.921913/16 [=======================>......] - ETA: 0s - loss: 0.3143 - accuracy: 0.906214/16 [=========================>....] - ETA: 0s - loss: 0.3109 - accuracy: 0.904015/16 [===========================>..] - ETA: 0s - loss: 0.3068 - accuracy: 0.908316/16 [==============================] - ETA: 0s - loss: 0.3027 - accuracy: 0.910016/16 [==============================] - 5s 306ms/step - loss: 0.3027 - accuracy: 0.9100
Epoch 5/10
 1/16 [>.............................] - ETA: 4s - loss: 0.0365 - accuracy: 1.0000 2/16 [==>...........................] - ETA: 4s - loss: 0.0592 - accuracy: 0.9844 3/16 [====>.........................] - ETA: 4s - loss: 0.0735 - accuracy: 0.9792 4/16 [======>.......................] - ETA: 4s - loss: 0.0778 - accuracy: 0.9844 5/16 [========>.....................] - ETA: 3s - loss: 0.1112 - accuracy: 0.9688 6/16 [==========>...................] - ETA: 3s - loss: 0.1078 - accuracy: 0.9740 7/16 [============>.................] - ETA: 3s - loss: 0.1091 - accuracy: 0.9777 8/16 [==============>...............] - ETA: 2s - loss: 0.1031 - accuracy: 0.9805 9/16 [===============>..............] - ETA: 2s - loss: 0.1032 - accuracy: 0.979210/16 [=================>............] - ETA: 2s - loss: 0.0969 - accuracy: 0.981211/16 [===================>..........] - ETA: 1s - loss: 0.0974 - accuracy: 0.983012/16 [=====================>........] - ETA: 1s - loss: 0.0945 - accuracy: 0.984413/16 [=======================>......] - ETA: 0s - loss: 0.0927 - accuracy: 0.985614/16 [=========================>....] - ETA: 0s - loss: 0.0925 - accuracy: 0.986615/16 [===========================>..] - ETA: 0s - loss: 0.0898 - accuracy: 0.987516/16 [==============================] - ETA: 0s - loss: 0.0882 - accuracy: 0.988016/16 [==============================] - 5s 323ms/step - loss: 0.0882 - accuracy: 0.9880
Epoch 6/10
 1/16 [>.............................] - ETA: 5s - loss: 0.0014 - accuracy: 1.0000 2/16 [==>...........................] - ETA: 5s - loss: 0.0119 - accuracy: 1.0000 3/16 [====>.........................] - ETA: 4s - loss: 0.0226 - accuracy: 0.9896 4/16 [======>.......................] - ETA: 4s - loss: 0.0216 - accuracy: 0.9922 5/16 [========>.....................] - ETA: 3s - loss: 0.0437 - accuracy: 0.9875 6/16 [==========>...................] - ETA: 3s - loss: 0.0419 - accuracy: 0.9896 7/16 [============>.................] - ETA: 3s - loss: 0.0469 - accuracy: 0.9866 8/16 [==============>...............] - ETA: 2s - loss: 0.0479 - accuracy: 0.9883 9/16 [===============>..............] - ETA: 2s - loss: 0.0456 - accuracy: 0.989610/16 [=================>............] - ETA: 2s - loss: 0.0429 - accuracy: 0.990611/16 [===================>..........] - ETA: 1s - loss: 0.0412 - accuracy: 0.991512/16 [=====================>........] - ETA: 1s - loss: 0.0404 - accuracy: 0.992213/16 [=======================>......] - ETA: 1s - loss: 0.0401 - accuracy: 0.992814/16 [=========================>....] - ETA: 0s - loss: 0.0401 - accuracy: 0.993315/16 [===========================>..] - ETA: 0s - loss: 0.0391 - accuracy: 0.993716/16 [==============================] - ETA: 0s - loss: 0.0393 - accuracy: 0.994016/16 [==============================] - 5s 330ms/step - loss: 0.0393 - accuracy: 0.9940
Epoch 7/10
 1/16 [>.............................] - ETA: 4s - loss: 0.0021 - accuracy: 1.0000 2/16 [==>...........................] - ETA: 4s - loss: 0.0091 - accuracy: 1.0000 3/16 [====>.........................] - ETA: 4s - loss: 0.0137 - accuracy: 1.0000 4/16 [======>.......................] - ETA: 4s - loss: 0.0169 - accuracy: 1.0000 5/16 [========>.....................] - ETA: 3s - loss: 0.0157 - accuracy: 1.0000 6/16 [==========>...................] - ETA: 3s - loss: 0.0152 - accuracy: 1.0000 7/16 [============>.................] - ETA: 3s - loss: 0.0148 - accuracy: 1.0000 8/16 [==============>...............] - ETA: 2s - loss: 0.0146 - accuracy: 1.0000 9/16 [===============>..............] - ETA: 2s - loss: 0.0147 - accuracy: 1.000010/16 [=================>............] - ETA: 2s - loss: 0.0176 - accuracy: 1.000011/16 [===================>..........] - ETA: 1s - loss: 0.0205 - accuracy: 0.997212/16 [=====================>........] - ETA: 1s - loss: 0.0252 - accuracy: 0.994813/16 [=======================>......] - ETA: 0s - loss: 0.0246 - accuracy: 0.995214/16 [=========================>....] - ETA: 0s - loss: 0.0235 - accuracy: 0.995515/16 [===========================>..] - ETA: 0s - loss: 0.0229 - accuracy: 0.995816/16 [==============================] - ETA: 0s - loss: 0.0228 - accuracy: 0.996016/16 [==============================] - 5s 332ms/step - loss: 0.0228 - accuracy: 0.9960
Epoch 8/10
 1/16 [>.............................] - ETA: 4s - loss: 0.0149 - accuracy: 1.0000 2/16 [==>...........................] - ETA: 4s - loss: 0.0193 - accuracy: 1.0000 3/16 [====>.........................] - ETA: 4s - loss: 0.0180 - accuracy: 1.0000 4/16 [======>.......................] - ETA: 4s - loss: 0.0510 - accuracy: 0.9844 5/16 [========>.....................] - ETA: 3s - loss: 0.0505 - accuracy: 0.9875 6/16 [==========>...................] - ETA: 3s - loss: 0.0450 - accuracy: 0.9896 7/16 [============>.................] - ETA: 3s - loss: 0.0435 - accuracy: 0.9911 8/16 [==============>...............] - ETA: 2s - loss: 0.0482 - accuracy: 0.9883 9/16 [===============>..............] - ETA: 2s - loss: 0.0475 - accuracy: 0.989610/16 [=================>............] - ETA: 2s - loss: 0.0469 - accuracy: 0.990611/16 [===================>..........] - ETA: 1s - loss: 0.0483 - accuracy: 0.988612/16 [=====================>........] - ETA: 1s - loss: 0.0460 - accuracy: 0.989613/16 [=======================>......] - ETA: 1s - loss: 0.0463 - accuracy: 0.990414/16 [=========================>....] - ETA: 0s - loss: 0.0457 - accuracy: 0.991115/16 [===========================>..] - ETA: 0s - loss: 0.0447 - accuracy: 0.991716/16 [==============================] - ETA: 0s - loss: 0.0434 - accuracy: 0.992016/16 [==============================] - 5s 324ms/step - loss: 0.0434 - accuracy: 0.9920
Epoch 9/10
 1/16 [>.............................] - ETA: 5s - loss: 0.0084 - accuracy: 1.0000 2/16 [==>...........................] - ETA: 4s - loss: 0.0074 - accuracy: 1.0000 3/16 [====>.........................] - ETA: 4s - loss: 0.0090 - accuracy: 1.0000 4/16 [======>.......................] - ETA: 3s - loss: 0.0138 - accuracy: 1.0000 5/16 [========>.....................] - ETA: 3s - loss: 0.0133 - accuracy: 1.0000 6/16 [==========>...................] - ETA: 3s - loss: 0.0119 - accuracy: 1.0000 7/16 [============>.................] - ETA: 2s - loss: 0.0111 - accuracy: 1.0000 8/16 [==============>...............] - ETA: 2s - loss: 0.0101 - accuracy: 1.0000 9/16 [===============>..............] - ETA: 2s - loss: 0.0094 - accuracy: 1.000010/16 [=================>............] - ETA: 1s - loss: 0.0091 - accuracy: 1.000011/16 [===================>..........] - ETA: 1s - loss: 0.0089 - accuracy: 1.000012/16 [=====================>........] - ETA: 1s - loss: 0.0085 - accuracy: 1.000013/16 [=======================>......] - ETA: 0s - loss: 0.0083 - accuracy: 1.000014/16 [=========================>....] - ETA: 0s - loss: 0.0083 - accuracy: 1.000015/16 [===========================>..] - ETA: 0s - loss: 0.0084 - accuracy: 1.000016/16 [==============================] - ETA: 0s - loss: 0.0085 - accuracy: 1.000016/16 [==============================] - 5s 308ms/step - loss: 0.0085 - accuracy: 1.0000
Epoch 10/10
 1/16 [>.............................] - ETA: 4s - loss: 5.2566e-04 - accuracy: 1.0000 2/16 [==>...........................] - ETA: 4s - loss: 0.0012 - accuracy: 1.0000     3/16 [====>.........................] - ETA: 4s - loss: 0.0018 - accuracy: 1.0000 4/16 [======>.......................] - ETA: 3s - loss: 0.0026 - accuracy: 1.0000 5/16 [========>.....................] - ETA: 3s - loss: 0.0028 - accuracy: 1.0000 6/16 [==========>...................] - ETA: 3s - loss: 0.0027 - accuracy: 1.0000 7/16 [============>.................] - ETA: 2s - loss: 0.0026 - accuracy: 1.0000 8/16 [==============>...............] - ETA: 2s - loss: 0.0028 - accuracy: 1.0000 9/16 [===============>..............] - ETA: 2s - loss: 0.0027 - accuracy: 1.000010/16 [=================>............] - ETA: 1s - loss: 0.0027 - accuracy: 1.000011/16 [===================>..........] - ETA: 1s - loss: 0.0028 - accuracy: 1.000012/16 [=====================>........] - ETA: 1s - loss: 0.0029 - accuracy: 1.000013/16 [=======================>......] - ETA: 0s - loss: 0.0030 - accuracy: 1.000014/16 [=========================>....] - ETA: 0s - loss: 0.0032 - accuracy: 1.000015/16 [===========================>..] - ETA: 0s - loss: 0.0033 - accuracy: 1.000016/16 [==============================] - ETA: 0s - loss: 0.0034 - accuracy: 1.000016/16 [==============================] - 5s 315ms/step - loss: 0.0034 - accuracy: 1.0000
Final training accuracy: 1.0000
/opt/bitnami/python/lib/python3.8/site-packages/keras/src/engine/training.py:3000: UserWarning: You are saving your model as an HDF5 file via `model.save()`. This file format is considered legacy. We recommend using instead the native Keras format, e.g. `model.save('my_model.keras')`.
  saving_api.save_model(
Model saved as 'simple_lung_cancer_model.h5'
Evaluating on test dataset...
